{% extends 'accounts/base.html' %}
{% load static %}

{% block title %}Order Details - Laundry Management System{% endblock %}
{% block page_title %}Order Details{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounts/css/profile.css' %}">
<style>
    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        margin-top: 2rem;
    }
    .action-buttons.top-right {
        justify-content: flex-end;
        margin-top: 0;
        margin-bottom: 1.5rem;
    }
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        display: inline-block;
    }
    .status-pending {
        background: #fff3cd;
        color: #856404;
    }
    .status-in-progress {
        background: #cfe2ff;
        color: #084298;
    }
    .status-ready {
        background: #d1e7dd;
        color: #0f5132;
    }
    .status-completed {
        background: #d1e7dd;
        color: #0f5132;
    }
    .status-cancelled {
        background: #f8d7da;
        color: #721c24;
    }
    .payment-pending {
        background: #fff3cd;
        color: #856404;
    }
    .payment-partially-paid {
        background: #cfe2ff;
        color: #084298;
    }
    .payment-paid {
        background: #d1e7dd;
        color: #0f5132;
    }
    .info-grid-two-columns {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }
    .info-column {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    @media (max-width: 768px) {
        .info-grid-two-columns {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
    }
    .order-items-table-container {
        overflow-x: auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-top: 1rem;
    }
    .order-items-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
    }
    .order-items-table thead {
        background: #f8f9fa;
    }
    .order-items-table th {
        padding: 0.75rem 1rem;
        text-align: left;
        font-weight: 600;
        color: #495057;
        border-bottom: 2px solid #dee2e6;
        white-space: nowrap;
    }
    .order-items-table th:first-child {
        width: 40px;
        text-align: center;
    }
    .order-items-table th:nth-child(3),
    .order-items-table th:nth-child(4) {
        text-align: center;
    }
    .order-items-table th:nth-child(5),
    .order-items-table th:nth-child(6) {
        text-align: right;
    }
    .order-items-table td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e9ecef;
        color: #495057;
    }
    .order-items-table td:first-child {
        text-align: center;
        color: #6c757d;
        font-weight: 500;
    }
    .order-items-table td:nth-child(3),
    .order-items-table td:nth-child(4) {
        text-align: center;
    }
    .order-items-table td:nth-child(5),
    .order-items-table td:nth-child(6) {
        text-align: right;
        font-weight: 500;
    }
    .order-items-table tbody tr:hover {
        background: #f8f9fa;
    }
    .order-items-table tbody tr:last-child td {
        border-bottom: none;
    }
    .order-items-total-row {
        background: #e7f3ff;
        border-top: 2px solid #007bff;
    }
    .order-items-total-row td {
        padding: 1rem;
        font-size: 1rem;
    }
    .order-items-table td:last-child {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-card">
        <div class="profile-header">
            <div class="profile-avatar">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11l3 3L22 4"></path>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                </svg>
            </div>
            <div class="profile-info">
                <h2 id="orderNumber">Loading...</h2>
                <p id="customerName">Loading...</p>
                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                    <span class="status-badge" id="orderStatusBadge">Loading...</span>
                    <span class="status-badge" id="paymentStatusBadge">Loading...</span>
                </div>
            </div>
        </div>

        <div class="profile-content">
            <div class="info-section">
                <h3>Order Information</h3>
                <div class="info-grid-two-columns">
                    <div class="info-column">
                        <div class="info-item">
                            <label>Order Number</label>
                            <p id="orderNumberDetail">-</p>
                        </div>
                        <div class="info-item">
                            <label>Customer</label>
                            <p id="customer">-</p>
                        </div>
                        <div class="info-item">
                            <label>Assigned To</label>
                            <p id="assignedTo">-</p>
                        </div>
                        <div class="info-item">
                            <label>Order Status</label>
                            <p id="orderStatus">-</p>
                        </div>
                        <div class="info-item">
                            <label>Payment Status</label>
                            <p id="paymentStatus">-</p>
                        </div>
                        <div class="info-item">
                            <label>Total Amount</label>
                            <p id="totalAmount">-</p>
                        </div>
                        <div class="info-item">
                            <label>Amount Paid</label>
                            <p id="amountPaid">-</p>
                        </div>
                        <div class="info-item">
                            <label>Discount Amount</label>
                            <p id="discountAmount">-</p>
                        </div>
                        <div class="info-item">
                            <label>Pickup Date</label>
                            <p id="pickupDate">-</p>
                        </div>
                        <div class="info-item">
                            <label>Delivery Date</label>
                            <p id="deliveryDate">-</p>
                        </div>
                    </div>
                    <div class="info-column">
                        <div class="info-item">
                            <label>Estimated Completion Date</label>
                            <p id="estimatedCompletionDate">-</p>
                        </div>
                        <div class="info-item">
                            <label>Completed At</label>
                            <p id="completedAt">-</p>
                        </div>
                        <div class="info-item full-width">
                            <label>Delivery Notes</label>
                            <p id="deliveryNotes">-</p>
                        </div>
                        <div class="info-item full-width">
                            <label>Special Instructions</label>
                            <p id="specialInstructions">-</p>
                        </div>
                        <div class="info-item">
                            <label>Created At</label>
                            <p id="createdAt">-</p>
                        </div>
                        <div class="info-item">
                            <label>Created By</label>
                            <p id="createdBy">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-section" id="orderItemsSection" style="display: none;">
                <h3>Order Items</h3>
                <div class="order-items-table-container">
                    <table class="order-items-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Service</th>
                                <th>Item Name</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Subtotal</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody id="orderItemsTableBody">
                            <!-- Order items will be populated here -->
                        </tbody>
                        <tfoot id="orderItemsTableFooter" style="display: none;">
                            <tr class="order-items-total-row">
                                <td colspan="5" style="text-align: right; font-weight: 600;">Total:</td>
                                <td id="orderItemsTotal" style="font-weight: 600; color: #007bff;">â‚¦0.00</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <div class="action-buttons" id="clientActionButtons" style="display: none;">
                <button id="confirmOrderBtn" class="btn btn-primary">Confirm Order</button>
                <button id="makePaymentBtn" class="btn btn-success">Make Payment</button>
                <a href="{% url 'orders_list' %}" class="btn btn-secondary">Back to Orders</a>
            </div>
            <div class="action-buttons" id="staffActionButtons" style="display: none;">
                <a href="{% url 'orders_list' %}" class="btn btn-secondary">Back to Orders</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'orders/js/order_detail.js' %}"></script>
{% endblock %}
